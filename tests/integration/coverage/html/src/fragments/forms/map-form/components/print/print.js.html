<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/fragments/forms/map-form/components/print/print.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../../../index.html">all files</a> / <a href="index.html">src/fragments/forms/map-form/components/print/</a> print.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/63</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/63</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import MapViewData from '@/models/map-view-data'
import constants from '@/resources/constants'
import DomToImage from 'dom-to-image'
import Vue from 'vue'
&nbsp;
// Printing templates
import PrintDirections from './components/directions-template/PrintDirections'
import PrintIsochrones from './components/isochrones-template/PrintIsochrones'
import PrintPlace from './components/place-template/PrintPlace'
&nbsp;
export default {
  created() {
<span class="cstat-no" title="statement not covered" >    this.localMapViewData = this.mapViewData</span>
  },
  data: () =&gt; (<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >{</span></span>
    localMapViewData: null,
    modePrintingHtml: null
  }),
  props: {
    mapViewData: {
      type: MapViewData
    }
  },
  computed: {
    title() {
<span class="cstat-no" title="statement not covered" >      return document.title</span>
    },
    hostname() {
<span class="cstat-no" title="statement not covered" >      return location.hostname</span>
    }
  },
  methods: {
    /**
     * Generate and print view
     */
    generateAndPrintView() {
<span class="cstat-no" title="statement not covered" >      this.showInfo(this.$t('print.preparingPrinting'), { timeout: 0 })</span>
      // Make sure the sidebar is closed before the 
      // map view image is captured
      let leftSideBarOpen = <span class="cstat-no" title="statement not covered" >this.$store.getters.leftSideBarOpen</span>
      let sidebarIsPinned = <span class="cstat-no" title="statement not covered" >this.$store.getters.leftSideBarPinned</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (leftSideBarOpen) {</span>
<span class="cstat-no" title="statement not covered" >        this.$store.commit('setLeftSideBarIsOpen', !leftSideBarOpen)</span>
      }
<span class="cstat-no" title="statement not covered" >      if (sidebarIsPinned) {</span>
<span class="cstat-no" title="statement not covered" >        this.$store.commit('setLeftSideBarIsPinned', !sidebarIsPinned)</span>
      }
&nbsp;
      // Wait a bit so that the sidebar is closed (it it was open)
<span class="cstat-no" title="statement not covered" >      setTimeout(() =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
        // Get current rendered map view from DOM
        let mapView = <span class="cstat-no" title="statement not covered" >document.getElementById(constants.mapViewElementId)</span>
&nbsp;
        // Hide all over map elements before 
        // capturing the map view image
<span class="cstat-no" title="statement not covered" >        this.setMapViewControlsVisibility(mapView, false)</span>
        let context = <span class="cstat-no" title="statement not covered" >this</span>
&nbsp;
        // Generate a PNG image from the current map view
        // and then print the instructions
<span class="cstat-no" title="statement not covered" >        DomToImage.toPng(mapView).then((mapImageUrlData) =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
          // Restore the visibility of over map elements
<span class="cstat-no" title="statement not covered" >          context.setMapViewControlsVisibility(mapView, true)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          context.setTemplatePrintingHtml(mapImageUrlData)</span>
&nbsp;
          // Wait a bit to make sure that the `modePrintingHtml`
          // is rendered in the view, because it will be part of the
          // printed content
<span class="cstat-no" title="statement not covered" >          setTimeout(() =&gt; <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >            context.printView()</span>
            // Restore previous state of the sidebar openness
<span class="cstat-no" title="statement not covered" >            context.$store.commit('setLeftSideBarIsOpen', leftSideBarOpen)</span>
<span class="cstat-no" title="statement not covered" >            context.$store.commit('setLeftSideBarIsPinned', sidebarIsPinned)</span>
<span class="cstat-no" title="statement not covered" >            context.showSuccess(context.$t('print.readyToPrint'))</span>
          }, 500)
        })
      }, 1000)
    },
&nbsp;
    /**
     * Set the printing HTML based on the mode template
     * @param {String} mapImageUrlData 
     * @returns {String}
     */
    setTemplatePrintingHtml(mapImageUrlData) {
      var PrintTemplateClass
&nbsp;
      // Define the printing template based on the `mode`
<span class="cstat-no" title="statement not covered" >      switch (this.localMapViewData.mode) {</span>
        case constants.modes.directions:
        case constants.modes.roundTrip:
<span class="cstat-no" title="statement not covered" >          PrintTemplateClass = Vue.extend(PrintDirections)</span>
<span class="cstat-no" title="statement not covered" >          break</span>
        case constants.modes.place:
<span class="cstat-no" title="statement not covered" >          PrintTemplateClass = Vue.extend(PrintPlace)</span>
<span class="cstat-no" title="statement not covered" >          break</span>
        case constants.modes.isochrones:
<span class="cstat-no" title="statement not covered" >          PrintTemplateClass = Vue.extend(PrintIsochrones)</span>
<span class="cstat-no" title="statement not covered" >          break</span>
        default:
<span class="cstat-no" title="statement not covered" >          break</span>
      }
      let propsData = <span class="cstat-no" title="statement not covered" >{</span>
        mapViewData: this.mapViewData,
        mapViewImage: mapImageUrlData
      }
      let bidingData = <span class="cstat-no" title="statement not covered" >{</span>
        propsData,
        i18n: this.$i18n,
        store: this.$store
      }
      var printingTemplate = <span class="cstat-no" title="statement not covered" >new PrintTemplateClass(bidingData)</span>
<span class="cstat-no" title="statement not covered" >      this.modePrintingHtml = printingTemplate.$mount().$el.innerHTML</span>
    },
&nbsp;
    /**
     * Print the view using a hidden iframe
     */
    printView() {
      let htmlData = <span class="cstat-no" title="statement not covered" >this.$refs.printableElement.innerHTML</span>
      var frame1 = <span class="cstat-no" title="statement not covered" >document.createElement('iframe')</span>
<span class="cstat-no" title="statement not covered" >      frame1.name = 'frame1'</span>
<span class="cstat-no" title="statement not covered" >      frame1.style.position = 'absolute'</span>
<span class="cstat-no" title="statement not covered" >      frame1.style.top = '-1000000px'</span>
<span class="cstat-no" title="statement not covered" >      document.body.appendChild(frame1)</span>
      var frameDoc = <span class="cstat-no" title="statement not covered" >frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1.contentDocument.document : frame1.contentDocument</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      frameDoc.document.open()</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.write(`&lt;html&gt;&lt;head&gt;&lt;title&gt;${document.title}&lt;/title&gt;`)</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.write('&lt;style type="text/css"&gt;@media print { body {-webkit-print-color-adjust: exact;}}&lt;/style&gt;')</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.write('&lt;/head&gt;&lt;body&gt;')</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.write(htmlData)</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.write('&lt;/body&gt;&lt;/html&gt;')</span>
<span class="cstat-no" title="statement not covered" >      frameDoc.document.close()</span>
<span class="cstat-no" title="statement not covered" >      setTimeout(function () <span class="fstat-no" title="function not covered" >{</span></span>
<span class="cstat-no" title="statement not covered" >        window.frames['frame1'].focus()</span>
<span class="cstat-no" title="statement not covered" >        window.frames['frame1'].print()</span>
<span class="cstat-no" title="statement not covered" >        document.body.removeChild(frame1)</span>
      }, 500)
<span class="cstat-no" title="statement not covered" >      return false</span>
    },
&nbsp;
    /**
     * Set map view controls visibility
     * @param {HtmlNode} mapView 
     * @param {Boolean} visible 
     */
    setMapViewControlsVisibility(mapView, visible) {
      let buttonsOverMap = <span class="cstat-no" title="statement not covered" >mapView.getElementsByClassName('v-btn')</span>
<span class="cstat-no" title="statement not covered" >      for (var i = 0; i &lt; buttonsOverMap.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >        buttonsOverMap[i].style.display = visible ? 'block' : 'none'</span>
      }
      let leafletControls = <span class="cstat-no" title="statement not covered" >mapView.getElementsByClassName('leaflet-control')</span>
<span class="cstat-no" title="statement not covered" >      for (var j = 0; j &lt; leafletControls.length; j++) {</span>
<span class="cstat-no" title="statement not covered" >        leafletControls[j].style.display = visible ? 'block' : 'none'</span>
      }
      let leafletPopups = <span class="cstat-no" title="statement not covered" >mapView.getElementsByClassName('leaflet-popup')</span>
<span class="cstat-no" title="statement not covered" >      for (var k = 0; k &lt; leafletPopups.length; k++) {</span>
<span class="cstat-no" title="statement not covered" >        leafletPopups[k].style.display = visible ? 'block' : 'none'</span>
      }
    }
  }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Oct 21 2021 16:51:51 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../../sorter.js"></script>
</body>
</html>
